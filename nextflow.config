/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    UMCUGenetics/DxNextflowRNA Nextflow config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

manifest {
    name = 'UMCUGenetics/DxNextflowRNA'
    author = """UMCU Genetics"""
    homePage = 'https://github.com/UMCUGenetics/DxNextflowRNA'
    description = """UMCU Genetics RNA Workflow"""
    mainScript = 'main.nf'
    nextflowVersion = '!>=23.04.0'
    version = '1.0dev'
    doi = ''
}

// Nextflow plugins
plugins {
    id 'nf-validation' // Validation of pipeline parameters and creation of an input channel from a sample sheet
}

// Global default params, used in configs
params {
    // Metadata sequencers
    seq_platform = 'Illumina'
    seq_center = 'UMCU Genetics'

    // Reference files
    // Homo_sapiens GRCh38 GCA_000001405.15
    genome_base = "/hpc/diaggen/users/ellen/references/GRCh38_gencode_v22_CTAT_lib_Mar012021.plug-n-play/ctat_genome_lib_build_dir"
    fasta = "${params.genome_base}/ref_genome.fa"
    fai = "${params.genome_base}/ref_genome.fa.fai"
    gtf = "${params.genome_base}/ref_annot.gtf"
    star_index = "${params.genome_base}/ref_genome.fa.star.idx/"

    // Custom reference files GRCh38
    ctat_genome_lib_build_dir = null
    gene_bed = "/hpc/diaggen/users/ellen/references/GRCh38_gencode_v22_CTAT_lib_Mar012021.ref_annot.gtf.bed"
    ref_flat = "/hpc/diaggen/users/ellen/references/GRCh38_gencode_v22_CTAT_lib_Mar012021.ref_annot.gtf.refflat"
    rrna_intervals = "/hpc/diaggen/users/ellen/references/hg38_rRNA_genbank.intervallist"

    multiqc_yaml = "${projectDir}/assets/multiqc_config.yml"
    // Input options
    input = null

    // Output options
    outdir = null
    publish_dir_mode = 'link'
    email = null

    cluster_options = "--mail-user ${params.email} --mail-type FAIL --account=diaggen"

    // Tool arguments
    rseqc_modules = "bam_stat,infer_experiment,inner_distance,junction_annotation,junction_saturation,read_distribution,read_duplication"
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Load base.config
includeConfig 'conf/base.config'

// Load modules.config for module specific options
includeConfig 'conf/modules.config'

report {
    enabled = true
    file = "$params.outdir/log/nextflow_report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "$params.outdir/log/nextflow_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
    overwrite = true
}

timeline {
    enabled = true
    file = "$params.outdir/log/nextflow_timeline.html"
    overwrite = true
}
